---
title: "Applied Data Skills for Processing and Presenting Data"
subtitle: "Summative Assessment: Energy"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_width: 8
    fig_height: 5
    fig_caption: true
    df_print: kable
    theme: 
      version: 5
      bootswatch: litera
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    toc_depth: 3
    number_sections: false
bibliography: export.bib
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(
  echo       = FALSE,    # whether to show code chunks
  message    = FALSE,    # whether to show messages from your code
  warning    = FALSE,    # whether to show warnings from your code
  fig.width  = 8,        # figure width in inches (at 96 dpi)
  fig.height = 5,        # figure height in inches (at 96 dpi)
  fig.align  = "center", # align figures to centre of page
  out.width = "90%"      # figures/images span 90% of the page width
)

# Load libraries
library(tidyverse)    # all the useful things
library(conflicted)   # makes conflicts between tidyverse and other packages explicit
library(kableExtra)   # more table options
library(forcats)      # useful factor tools
library(scales)       # useful number formatting tools (e.g. adding commas, scaling, displaying currency)
library(plotly)       # interactive graphs
library(htmltools)    # loop generated tabsets
library(captioner)    # captions for figures and tables

# Set random seed for ggrepel (for reproducibility)
set.seed(42)
```

```{r file-import }

# Import each of the CSV files

owid_energy <- read_csv("data/owid-energy-data.csv")

elec_access <- read_csv("data/number-of-people-with-and-without-electricity-access.csv")

iso_codes <- read_csv("data/ISO_codes.csv")

```

```{r captions }
# Captioner options
table_nums <- captioner(prefix = "Table")

# Reference captioned things
f.ref <- function(x) {
  stringr::str_extract(table_nums(x), "[^:]*")
}

# Tables
tab.1_cap <- table_nums(name = "tab_1",
                        caption = "Peak Total Energy Consumption by Continent")
tab.2_cap <- table_nums(name = "tab_2",
                        caption = "Peak Per Capita Energy Consumption by Continent")

```

## Introduction

This report will offer evidence-based advice on where to invest to best contribute to solving the ongoing energy crisis.

## Trends in historical electricity production

```{r highest-all-time-electricity-production }

# Averaging across time, which is the energy source (e.g. fossil fuels, nuclear power, and
# renewables) that generates the highest amount of electricity worldwide. How much
# electricity has been generated from each of these sources?

# OWID Energy Data is huge, first, trim to the useful columns:
# fossil_electricity (all of coal, oil and gas)
# nuclear_electricity
# renewables_electricity (all renewable sources, inc. solar, wind, biofuels and other)

dfTotalElectricityOverTimeBySource <- owid_energy %>%
  # Filter to world level data
  dplyr::filter(country == "World") %>%
  # Trim columns
  select(fossil_electricity, nuclear_electricity, renewables_electricity) %>%
  # Get totals for each column excluding NA values
  summarise(Fossil = sum(fossil_electricity, na.rm = TRUE),
            Nuclear = sum(nuclear_electricity, na.rm = TRUE),
            Renewables = sum(renewables_electricity, na.rm = TRUE)) %>%
  # Flip columns to rows to make better table
  pivot_longer(everything(), names_to = "source", values_to = "production") %>%
  # Order by highest value first
  arrange(desc(production)) %>%
  mutate(percentage = production / sum(production))

```

Over time, well over half of the total electricity produced (`r percent(as.numeric(dfTotalElectricityOverTimeBySource[1,3]), accuracy = 0.01)`) has come from fossil fuels, i.e coal, oil and gas. A further quarter (`r percent(as.numeric(dfTotalElectricityOverTimeBySource[2,3]), accuracy = 0.01)`) has come from renewable sources, i.e. hydro, wind, solar and biofuels. Nuclear generated power accounts for the rest.

```{r highest-all-time-electricity-production-graph }

# For tidiness, order the columns highest to lowest value
# fct_reorder orders source by ascending values in production
# fct_rev reverses this order

dfTotalElectricityOverTimeBySource %>%
  plot_ly(
    data = .,
    x = ~ fct_rev(fct_reorder(source, production)),
    y = ~ production,
    type = "bar",
    # Add a label with the percentage value to the top of each column
    text = percent(dfTotalElectricityOverTimeBySource$percentage),
    # Use a colour blind (and monochrome printing) friendly colour
    marker = list(color = viridis_pal(option = "H")(1)),
    # Format the hover box
    # Show source name and production with 6 significant figures and grouped thousands
    # Do not show any extra text
    hovertemplate = paste('<b>Source</b>: %{x}',
                          '<br><b>Produced</b>: %{y:,.6r} MWh',
                          '<extra></extra>')
  ) %>%
  plotly::layout(
    title = "Total electricity generated worldwide by energy source",
    xaxis = list(title = FALSE),
    yaxis = list(title = "Total electricity produced (MWh)")
  )

```

<<<<<<< HEAD
## Trends in primary energy consumption
=======
```{r highest-alltime-production-table }

kable(dfTotalElectricityOverTimeBySource)

```


## Primary energy consumption changed across time
>>>>>>> 4918049ad97c6f0c4c5fbb1b71d6f4fe0ad83637

```{r energy-consumption-over-time }

# How has primary energy consumption (in terawatt-hours) changed worldwide across time?
# What are the key trends?

# Useful columns
# year, primary_energy_consumption

dfPrimaryEnergyConsumption <- owid_energy %>%
  # Filter to world level data
  dplyr::filter(country == "World") %>%
  select(year, primary_energy_consumption, energy_cons_change_pct) %>%
  # Remove any row with no data
  na.omit()

```

Between 1965 to 2019, global energy consumption approximately quadrupled from `r formatC(min(dfPrimaryEnergyConsumption$primary_energy_consumption), format = "f", big.mark = ",", digits = 0)` MWh to `r formatC(max(dfPrimaryEnergyConsumption$primary_energy_consumption), format = "f", big.mark = ",", digits = 0)` MWh.

```{r primary-energy-consumption-graph }

y2 = list(overlaying = "y", side = "right", title = "percentage growth (%)")

plot_ly() %>%
  add_trace(
    data = dfPrimaryEnergyConsumption,
    x = ~ year,
    y = ~ primary_energy_consumption,
    text = ~ energy_cons_change_pct,
    name = "p_e_c",
    type = "scatter",
    mode = "lines",
    # Format consumption with 6 significant figures and grouped thousands (and no extra text)
    hovertemplate = paste(
      '<b>Year</b>: %{x}',
      '<br><b>Consumed</b>: %{y:,.6r} MWh',
      '<br><b>%age change</b>: %{text:,.2f} %',
      '<extra></extra>'
    )
  ) %>%
  plotly::layout(
    title = "Total primary energy consumed per year worldwide (1965 - 2020)",
    xaxis = list(title = FALSE, nticks = 14),
    yaxis = list(title = "Total electricity consumed (MWh)"),
    color = viridis_pal(option = "H")(1)
  )

```

```{r figures-for-trends-text }

# Average increase 1965 ->1973
initial_avg_growth <- round(as.numeric(
  dfPrimaryEnergyConsumption %>%
    dplyr::filter(between(year, 1965, 1973)) %>%
    summarise(energy_cons_change_pct = mean(energy_cons_change_pct))
),
digits = 1)

# OAPEC embargo plateau 1974 -> 1975
oapec_embago_plateau <- round(as.numeric(
  dfPrimaryEnergyConsumption %>%
    dplyr::filter(between(year, 1974, 1975)) %>%
    summarise(energy_cons_change_pct = mean(energy_cons_change_pct))
),
digits = 2)

# Post Iranian Revolution drop 1980 -> 1982
iranian_revolution <- round(abs(
  as.numeric(
    dfPrimaryEnergyConsumption %>%
      dplyr::filter(between(year, 1980, 1982)) %>%
      summarise(energy_cons_change_pct = mean(energy_cons_change_pct))
  )
),
digits = 2)

# Continued growth 1983 -> 2007

end_century_growth <- round(as.numeric(
    dfPrimaryEnergyConsumption %>%
      dplyr::filter(between(year, 1983, 2007)) %>%
      summarise(energy_cons_change_pct = mean(energy_cons_change_pct))
  ),
digits = 2)

# Peak end century growth
peak_end_century_growth <- as.numeric(
    dfPrimaryEnergyConsumption %>%
      dplyr::filter(between(year, 1983, 2007)) %>%
      summarise(energy_cons_change_pct = max(energy_cons_change_pct))
  )

peak_year <- 
  as.numeric(dfPrimaryEnergyConsumption[dfPrimaryEnergyConsumption$energy_cons_change_pct == peak_end_century_growth,][1])

# Percentage drop in energy consumption 2008 -> 2009
financial_crisis <-
  round(abs(as.numeric(dfPrimaryEnergyConsumption[dfPrimaryEnergyConsumption$year == "2009",][3])),
        digits = 2)

# Percentage drip in energy consumption 2019 -> 2020
covid_pandemic <-
  round(abs(as.numeric(dfPrimaryEnergyConsumption[dfPrimaryEnergyConsumption$year == "2020", ][3])),
        digits = 2)

```


From the mid 1960s, global energy consumption was growing at an annual average rate of `r initial_avg_growth`%. Consumption falls have been corrolated with high oil prices, e.g. in 1974 and 1975, annual average growth dropped to `r oapec_embago_plateau`% because of OAPEC embargoes whilethe Iranian Revolution saw energy consumption decline by an average of `r iranian_revolution`% between 1980 and 1982.

Consumption growth slowed to `r end_century_growth`% (peaking at `r round(peak_end_century_growth, digits = 2)`% in `r peak_year`) until the global financial crisis saw consumption cut by `r financial_crisis`% in 2009. However, from 2010 the growth rate recovered.

In 2020, a further slump in consumption of `r covid_pandemic`% occurred, likely due to reactions to the COVID-19 pandemic, however, it seems likely that growth will resume.

## Energy consumption by continent

```{r consumption-per-continent-specific-sources }

# Focussing on human energy consumption from specific sources (i.e. coal, oil, gas, nuclear,
# hydropower, solar, wind, and biofuel). How much energy has been consumed per continent
# for each year between 1970 and 2020? Comment on the trends you observe.

dfPerContinentPerSource <- owid_energy %>%
  # filter for rows where year between 1970 and 2020
  dplyr::filter(between(year,1970, 2020)) %>%
  # Merge continents data with owid_energy data
  left_join(iso_codes, by = c("iso_code" = "ISO_Code")) %>%
  rename(continent = Continent) %>%
  # Select useful columns
  select(continent, year, coal_consumption, oil_consumption, gas_consumption,
         nuclear_consumption, hydro_consumption, solar_consumption,
         wind_consumption, biofuel_consumption) %>%
  # filter for rows where continent is NA
  dplyr::filter(!is.na(continent)) %>%
  # replace all the NA data with 0 or the sum fails!!
  replace(is.na(.), 0) %>%
  group_by(continent, year) %>%
  # Summarise all the consumption columns
  summarise(across(where(is.numeric), sum)) %>%
  ungroup() %>%
  # Make the data longer
  pivot_longer(cols = ends_with("n"), names_to = "sources", values_to = "total") %>%
  # Factor and rename the sources data, convert the continents data to an ordered factor
  mutate(sources = fct_recode(sources, "Coal" = "coal_consumption", "Oil" = "oil_consumption",
                              "Gas" = "gas_consumption", "Nuclear" = "nuclear_consumption",
                              "Hydro" = "hydro_consumption", "Solar" = "solar_consumption",
                              "Wind" ="wind_consumption", "Biofuel" = "biofuel_consumption"),
         continent = fct_relevel(continent, "Africa", "Asia", "Europe", "North America",
                                 "South America", "Oceania"))

# Consumption totals per continent to use in text
dfPerContinentTotal <- owid_energy %>%
  # filter for rows where year between 1970 and 2020
  dplyr::filter(between(year, 1970, 2020)) %>%
  # Merge continents data with owid_energy data
  left_join(iso_codes, by = c("iso_code" = "ISO_Code")) %>%
  rename(continent = Continent) %>%
  # Select useful columns
  select(
    continent,
    year,
    fossil_fuel_consumption,
    renewables_consumption,
    nuclear_consumption,
    primary_energy_consumption,
    population,
    gdp,
    energy_per_capita,
    energy_per_gdp
  ) %>%
  # filter for rows where continent is NA
  dplyr::filter(!is.na(continent)) %>%
  # replace all the NA data with 0 or the sum fails!!
  replace(is.na(.), 0) %>%
  group_by(continent, year) %>%
  # Summarise all the consumption columns
  summarise(across(where(is.numeric), sum)) %>%
  ungroup()

```

Increases in energy consumption have not been spread evenly across the planet.

`r f.ref("tab_1")` shows that in Asia, Africa and Oceania, total electricity consumption peaked in 2019. However, in Europe and North and South America, total consumption peaked earlier.

```{r max-consumption-per-continent-tables}

# Table of maximum energy consumption by continent with year and population
dfContinentPeaks <- dfPerContinentTotal %>%
  select(continent,
         year,
         population,
         primary_energy_consumption) %>%
  # Group the data by continent and find the peak energy consumption figure for each one
  group_by(continent) %>%
  dplyr::filter(primary_energy_consumption == max(primary_energy_consumption)) %>%
  ungroup() %>%
  # Arrange the data from highest peak value to lowerst
  arrange(desc(primary_energy_consumption)) %>%
  mutate(
    # Calculate the percentage of the total peak energy consumption represented by each
    # continent's peak value and format as a percentage
    percentage = percent(primary_energy_consumption / sum(primary_energy_consumption)),
    # Format population and energy consumption as numbers with grouped thousands
    population = formatC(
      population,
      format = "f",
      big.mark = ",",
      digits = 0
    ),
    primary_energy_consumption = formatC(
      primary_energy_consumption,
      format = "f",
      big.mark = ",",
      digits = 0
    )
  )

dfContinentPeaks %>%
  kbl(
    # Left justify the first column, right justify the rest
    align = "lrrrr",
    # Add a table caption
    caption = tab.1_cap,
    # Make the column names friendly
    col.names = c(
      "Continent",
      "Year",
      "Population",
      "Total Consumption (TWh)",
      "% Peak Global Consumption"
    )
  ) %>%
  # Apply a style and do not force full page width
  kable_classic(full_width = FALSE)

```

Considering per capita consumption (see `r f.ref("tab_2")`), peak usage for Asia still occurs in 2019. However, all other regions peak much earlier.

```{r max-consumption-per-capita-table}

# Table of maximum energy consumption per capita with year and population
dfPerContinentTotal %>%
  select(continent,
         year,
         population,
         energy_per_capita) %>%
  group_by(continent) %>%
  dplyr::filter(energy_per_capita == max(energy_per_capita)) %>%
  ungroup() %>%
  arrange(desc(energy_per_capita)) %>%
  mutate(
    percentage = percent(energy_per_capita / sum(energy_per_capita)),
    population = formatC(
      population,
      format = "f",
      big.mark = ",",
      digits = 0
    ),
    energy_per_capita = energy_per_capita / 1000000,
    energy_per_capita = formatC(
      energy_per_capita,
      format = "f",
      big.mark = ",",
      digits = 2
    )
  ) %>%
  kbl(
    align = "lrrrr",
    caption = tab.2_cap,
    col.names = c(
      "Continent",
      "Year",
      "Population",
      "Per Capita Consumption (TWh)",
      "% Peak Global Consumption"
    )
  ) %>%
  kable_classic(full_width = FALSE)

```

Between 1970 and 2020, both Asia and Africa have seen high rates of population growth. All other continents have grown at much slower rates.

The jump in European population between 1984 and 1985 comes from a change in countries included in the data. Belarus, Estonia, Latvia, Lithuania, Russia and Ukraine were added in 1984. This significantly altered both the regional population size and electricity consumption figures.

```{r population-graph }

dfPerContinentTotal %>%
  plot_ly(
    data = .,
    x = ~ year,
    y = ~ population,
    color = ~ continent,
    colors = scales::viridis_pal(option = "H")(8),
    type = "scatter",
    mode = "lines",
    # format hover value to 8 significant figures and group thousands (no extra text)
    hovertemplate = paste('<b>Population</b>: %{y:,.8r}',
                          '<extra></extra>')
  ) %>%
  plotly::layout(title = "Population per Continent (1970 - 2020)",
                 xaxis = list(title = FALSE),
                 yaxis = list(title = "Total population"),
                 legend = list(orientation = "h"),
                 hovermode = "x unified")

```

Electricity consumption for all continents has generally risen over time. Furthermore, all continents are mostly reliant on a mix of fossil fuels, except for South America where coal is effectively replaced by hydroelectric sources.

The effects of the oil crises of the mid and late 1970s can be seen to a greater or lesser degree in the oil data for all continents.

```{r consumption-graphs-using-function }

consumption_chart <- function(continent_name) {
  dfPerContinentPerSource %>%
    dplyr::filter(continent == continent_name) %>%
    plot_ly(
      data = .,
      x = ~ year,
      y = ~ total,
      color = ~ sources,
      colors = scales::viridis_pal(option = "H")(8),
      type = "scatter",
      mode = "lines",
      # Format consumption with 2 decimal places (and no extra text)
      hovertemplate = paste('<b>Consumed</b>: %{y:0.2f} TWh',
                            '<extra></extra>')
    ) %>%
    plotly::layout(
      xaxis = list(title = FALSE, nticks = 12),
      yaxis = list(title = "Total electricity consumed (TWh)"),
      legend = list(orientation = "h"),
      # Values for all lines per x axis point on mouse hover
      hovermode = "x unified"
    )
}

```

### Oceania

`r consumption_chart("Oceania")`

Oceania has the lowest overall consumption of all sources of electricity, which can be accounted for by having the smallest continental population by a significant margin.

Fossil fuels are the main contributors and usage of oil and gas sourced electricity has risen steadily across the period. However, since 2008, use of coal has been in decline.

Hydroelectric power has been mostly constant contributor after fossil fuels, however since the late 1990s, solar and wind have become more significant contributors.

Oceania is a nuclear-free zone.

### Africa

`r consumption_chart("Africa")`

Electricity consumption in Africa is powered by fossil fuels and oil and gas usage continue to rise. However, since 2008, the coal usage has plateaued.

A constant small amount of hydroelectric power has been in use for the entire period, with a similar amount of nuclear power since 1984-5.

Renewable sources have only been used since the late 1990s. However, a sharp increase in the use of wind power since 2014, has seen it overtaking both nuclear and hydro consumption in 2018 and 2019 respectively.

### South America

`r consumption_chart("South America")`

South America has mainly been dependent on oil for electricity consumption, but this has been on the decline since 2014. Gas usage has also reduced since 2017.

Unlike any other continent, hydro electric power has provided more electricity than other fossil sources (coal and gas) since 1971. There has been a steady increase in the usage, though this has declined slightly since a peak in 2011.

Some nuclear power has been used since 1974, but has been overtaken by biofuels since their introduction in the late 1980s and by wind power in 2015 Solar power also seems likely to overtake nuclear before 2030.

### North America

`r consumption_chart("North America")`

North America is highly dependent on fossil fuels. However since 2008, the use of gas has increased significantly, while coal usage has plumeted.

Hydropower has been a steady contributor across the entire period, with nuclear providing similar amount since 1987.

Other renewables have become more prevalent since the late 1980s, with solar and wind experiencing rapid, and increasing, growth since 2005.

### Europe

`r consumption_chart("Europe")`

European consumption is driven by fossil fuels. Reduced consumption since a peak in 1990 has seen oil and coal usage fall significantly, however, gas consumption has continued to trend upwards.

Nuclear and hydro powered consumption have remained relatively stable since 1985.

Since the mid 1990s, there has been a significant increase in both wind and solar powered consumption.

### Asia

`r consumption_chart("Asia")`

Fossil fuels account for the majority of electricity consumption. The use of oil and gas use has risen consistently since 1970. However, between 2000 and 2015, the use of coal produced electricity in Asia more than doubled, overtaking oil as the most used energy source in 2004. This has been driven by coal use in China. 

Japan's Fukushima nuclear disaster in 2011 is reflected in a n% drop in nuclear consumption, which did not recover until 2019.

Hydropower has been in use across the entire time period and usage has been climbing more rapidly since the turn of the millennium. It remains the most used renewable source, however, both wind (since 2003) and solar (since 2009) have started to gain more traction.

## Electricity access for different income levels

```{r electricity-access-income }
# What is the percentage of people with/ without electricity access for different income
# categories? Comment on the trends for each year between 1990 and 2019, and focus on
# income categories labelled High income, Upper middle income, Lower middle income, and
# Low income.

# Discussion of data here: https://ourworldindata.org/energy-access
# World Bank defined income levels change each year (adjusted for inflation) and countries included do too
# Based on Gross National Income (GNI) per capita
# e.g. for 2020-2021 - 
#   https://blogs.worldbank.org/opendata/new-world-bank-country-classifications-income-level-2020-2021
# Historical classification spreadsheet here - 
#   https://datacatalogfiles.worldbank.org/ddh-published/0037712/DR0090754/OGHIST.xlsx

dfElectricityAccessIncome <- elec_access %>%
  select(!Code) %>%
  dplyr::filter(
    Entity %in% c(
      "High income",
      "Upper middle income",
      "Lower middle income",
      "Low income"
    ) &
      between(Year, 1990, 2019)
  ) %>%
  rename(
    "income_level" = "Entity",
    "year" = "Year",
    "with_access" = "Number of people with access to electricity",
    "without_access" = "Number of people without access to electricity"
  ) %>%
  # Summarise across years as percentage
  group_by(income_level, year) %>%
  mutate(
    pct_with = round(100 * with_access / sum(with_access, without_access), digits = 2),
    pct_without = round(100 * without_access / sum(with_access, without_access), digits = 2)
  ) %>%
  ungroup() %>%
  # Make income_levels a factor
  mutate(
    income_level = fct_recode(
      income_level,
      "High" = "High income",
      "Upper middle" = "Upper middle income",
      "Lower middle" = "Lower middle income",
      "Low" = "Low income"
    )
  )


```

```{r electricity-access-income-chart }

dfElectricityAccessIncome %>%
  plot_ly(
    data = .,
    x = ~ year,
    y = ~ pct_without,
    color = ~ fct_rev(fct_reorder(income_level, pct_without)),
    colors = scales::viridis_pal(option = "H")(8),
    type = "scatter",
    mode = "lines"
  ) %>%
  plotly::layout(
    title = "Percentage population without electricity access (1990 - 2019)",
    xaxis = list(title = FALSE),
    yaxis = list(title = FALSE, ticksuffix = "%"),
    legend = list(title = list(text = "<b>World Bank Income level:</b>"), orientation = "h"),
    # Values for all lines per x axis point on mouse hover
    hovermode = "x unified"
  )

```

Overall, between 1990 and 2019, the percentage of people lacking access to electricity fell across all income level groups.

However, in the lowest income group there have been three notable interruptions to the downward trend. In 2005 and 2011, the downward trend was reversed resulting in more people lacking access, and between 2012 and 2015, the rate of decrease slowed to nearly zero. Importantly, the current rate of decrease is also insufficient to meet the target of "universal access to affordable, reliable and modern energy services by 2030" from the UN's Sustainable Development Goals [@UN2015].

In the lower middle income group, despite an overall downward trend, increases in population without access to electricity occurred in 2001 and 2011.

## Climate Change

```{r climate-change }

dfClimateChange <- owid_energy %>%
  # data only starts in 2000
  dplyr::filter(between(year, 2000, 2020)) %>%
  # Select the useful columns
  select (iso_code, country, year, carbon_intensity_elec, greenhouse_gas_emissions) %>%
  # Filter out things that aren't countries (i.e no ISO code or one that isn't 3 characters long)
  dplyr::filter(str_length(iso_code) == 3) %>%
  # replace all the NA data with 0 or the sum fails!!
  replace(is.na(.), 0)

```

```{r climate-change-graphs }

# Maximum values to keep the scale the same across all chart years
max_greenhouse <- max(dfClimateChange$greenhouse_gas_emissions)
max_carbon <- max(dfClimateChange$carbon_intensity_elec)

# Choropleth map plot of values against built-in world map
greenhousegas <- plot_geo(dfClimateChange) %>%
  add_trace(
    # Use ISO code to determine country
    locations = ~ iso_code,
    # Use value of emissions to determine colour
    z = ~ greenhouse_gas_emissions,
    # Add full country name to hover text
    text = ~ country,
    # Use blue colour scheme
    colorscale = "Blues",
    # Flip scale to start with lightest colour at the bottom
    reversescale = TRUE,
    # Set up the animation, using the year to produce each frame
    frame = ~ year,
    # Set min and max values for the scale to apply to each frame
    # Avoids scale changing over time so animated colours are actually meaningful over time
    zmin = 0,
    zmax = max_greenhouse
  ) %>%
  # Add a title to the colorscale
  colorbar(title = "CO<sub>2</sub> eqivalent<br>(Megatonnes)") %>%
  # Add a title to the chart
  plotly::layout(title = "Greenhouse Gas Emissions Produced in the Generation of Electricity") %>%
  # Set the frame change speed in ms (i.e. 1s per frame)
  animation_opts(frame = 1000) %>%
  # Give the slider a title
  animation_slider(currentvalue = list(prefix = "Year: "))

# Use carbon intensity data to determine colour
carbonintensity <- plot_geo(dfClimateChange) %>%
  add_trace(
    locations = ~ iso_code,
    z = ~ carbon_intensity_elec,
    text = ~ country,
    colorscale = "Greens",
    reversescale = TRUE,
    frame = ~ year,
    zmin = 0,
    zmax = max_carbon
  ) %>%
  colorbar(title = "CO<sub>2</sub> emitted<br>(g/KWh)") %>%
  plotly::layout(title = "Carbon intensity of electricity production") %>%
  animation_opts(frame = 1000) %>%
  animation_slider(currentvalue = list(prefix = "Year: "))

```

Man-made climate change, driven by so called 'greenhouse gases', is one of the most significant global risks in the short and long term. While all continents still heavily reliant on inefficient and highly polluting fossil fuels for electricity production, the following animation clearly shows that China and the United States are the main contributors.

`r greenhousegas`

Carbon intensity is used to measure of the amount of carbon dioxide produced for each kilowatt hour of electricity generated, i.e. how "clean" the production is. The animation shows that between 2000 and 2020, very little progress has been made in improving carbon intensity of electricity generation around the world.

`r carbonintensity`

## Conclusion

From the data considered, there are three main areas that would benefit from increased funding. These are:

1. Increasing infrastructure for Lower middle, and particularly Low, income countries to further improve access to electricity for all
2. Increasing use of renewable sources everywhere as replacements for fossil fuels 
3. Improving efficiency of generation everywhere

Investment in the second two areas would aim to reduce the drivers of global climate change, which will disproportionate affect lower income countries.

## References

<div id="refs"></div>